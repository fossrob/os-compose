---
automatic-version-prefix: "39"
basearch: x86_64
mutate-os-release: "39"
ref: fedora/39/x86_64/silverblue
releasever: 39

repos:
  - fedora
  - fedora-updates

packages:
  - ModemManager
  - NetworkManager
  - NetworkManager-adsl
  - NetworkManager-bluetooth
  - NetworkManager-config-connectivity-fedora
  - NetworkManager-openconnect-gnome
  - NetworkManager-openvpn-gnome
  - NetworkManager-ppp
  - NetworkManager-pptp-gnome
  - NetworkManager-ssh-gnome
  - NetworkManager-vpnc-gnome
  - NetworkManager-wifi
  - NetworkManager-wwan
  - acl
  - adobe-source-code-pro-fonts
  - alsa-sof-firmware
  - alsa-ucm
  - alsa-utils
  - amd-gpu-firmware
  - at-spi2-atk
  - at-spi2-core
  - atheros-firmware
  - attr
  - audit
  - avahi
  - b43-fwcutter
  - b43-openfwwf
  - basesystem
  - bash
  - bash-color-prompt
  - bash-completion
  - bc
  - bind-utils
  - bluez-cups
  - brcmfmac-firmware
  - btrfs-progs
  - buildah
  - bzip2
  - chrony
  - cifs-utils
  - colord
  - compsize
  - coreutils
  - cpio
  - cryptsetup
  - cups
  - cups-browsed
  - cups-filters
  - curl
  - cyrus-sasl-plain
  - dconf
  - default-editor
  - default-fonts-cjk-mono
  - default-fonts-cjk-sans
  - default-fonts-cjk-serif
  - default-fonts-core-emoji
  - default-fonts-core-math
  - default-fonts-core-mono
  - default-fonts-core-sans
  - default-fonts-core-serif
  - default-fonts-other-mono
  - default-fonts-other-sans
  - default-fonts-other-serif
  - desktop-backgrounds-gnome
  - dhcp-client
  - dnsmasq
  - e2fsprogs
  - efibootmgr
  - ethtool
  - evince-previewer
  - evince-thumbnailer
  - exfatprogs
  - fedora-bookmarks
  - fedora-chromium-config
  - fedora-flathub-remote
  - fedora-release-silverblue
  - fedora-repos-archive
  - fedora-repos-ostree
  - fedora-workstation-backgrounds
  - fedora-workstation-repositories
  - file
  - filesystem
  - firefox
  - firewalld
  - flatpak
  - fpaste
  - fprintd-pam
  - fros-gnome
  - fwupd
  - gamemode
  - gdm
  - git-core
  - git-core-doc
  - glib-networking
  - glibc
  - glibc-all-langpacks
  - glx-utils
  - gnome-backgrounds
  - gnome-bluetooth
  - gnome-browser-connector
  - gnome-classic-session
  - gnome-color-manager
  - gnome-control-center
  - gnome-disk-utility
  - gnome-initial-setup
  - gnome-remote-desktop
  - gnome-session-wayland-session
  - gnome-session-xsession
  - gnome-settings-daemon
  - gnome-shell
  - gnome-shell-extension-background-logo
  - gnome-software
  - gnome-system-monitor
  - gnome-terminal
  - gnome-terminal-nautilus
  - gnome-user-docs
  - gnome-user-share
  - gnupg2
  - grub2-efi-ia32
  - grub2-efi-x64
  - grub2-pc
  - gstreamer1-plugin-libav
  - gstreamer1-plugins-bad-free
  - gstreamer1-plugins-good
  - gstreamer1-plugins-ugly-free
  - gutenprint
  - gutenprint-cups
  - gvfs-afc
  - gvfs-afp
  - gvfs-archive
  - gvfs-fuse
  - gvfs-goa
  - gvfs-gphoto2
  - gvfs-mtp
  - gvfs-smb
  - hfsplus-tools
  - hostname
  - hplip
  - hunspell
  - hyperv-daemons
  - ibus-anthy
  - ibus-gtk3
  - ibus-gtk4
  - ibus-hangul
  - ibus-libpinyin
  - ibus-libzhuyin
  - ibus-m17n
  - ibus-typing-booster
  - intel-gpu-firmware
  - iproute
  - iptables-nft
  - iptstate
  - iputils
  - iwlegacy-firmware
  - iwlwifi-dvm-firmware
  - iwlwifi-mvm-firmware
  - kbd
  - kernel
  - kernel-modules-extra
  - less
  - libertas-firmware
  - libglvnd-gles
  - librsvg2
  - libsane-hpaio
  - linux-firmware
  - logrotate
  - lrzsz
  - lsof
  - lvm2
  - man-db
  - man-pages
  - mcelog
  - mdadm
  - mesa-dri-drivers
  - mesa-libEGL
  - mesa-vulkan-drivers
  - microcode_ctl
  - mpage
  - mt7xxx-firmware
  - mtr
  - nautilus
  - ncurses
  - nfs-utils
  - nss-altfiles
  - nss-mdns
  - ntfs-3g
  - ntfsprogs
  - nvidia-gpu-firmware
  - open-vm-tools-desktop
  - opensc
  - openssh-clients
  - openssh-server
  - orca
  - ostree-grub2
  - pam_afs_session
  - paps
  - passwd
  - passwdqc
  - pciutils
  - pinentry-gnome3
  - pinfo
  - pipewire-alsa
  - pipewire-gstreamer
  - pipewire-pulseaudio
  - pipewire-utils
  - plocate
  - plymouth
  - plymouth-system-theme
  - podman
  - policycoreutils
  - policycoreutils-python-utils
  - polkit
  - procps-ng
  - psmisc
  - qadwaitadecorations-qt5
  - qemu-guest-agent
  - qgnomeplatform-qt5
  - qt5-qtbase
  - qt5-qtbase-gui
  - qt5-qtdeclarative
  - qt5-qtxmlpatterns
  - quota
  - realmd
  - realtek-firmware
  - rootfiles
  - rpm
  - rpm-ostree
  - rsync
  - rygel
  - samba-client
  - selinux-policy-targeted
  - setup
  - shadow-utils
  - shim-ia32
  - shim-x64
  - skopeo
  - sos
  - spice-vdagent
  - spice-webdavd
  - sssd
  - sssd-common
  - sssd-kcm
  - sudo
  - system-config-printer-udev
  - systemd
  - systemd-oomd-defaults
  - systemd-resolved
  - systemd-udev
  - tar
  - thermald
  - time
  - toolbox
  - totem-video-thumbnailer
  - tracker
  - tracker-miners
  - tree
  - unzip
  - uresourced
  - usb_modeswitch
  - usbutils
  - util-linux
  - vim-minimal
  - virtualbox-guest-additions
  - wget
  - which
  - whois
  - wireplumber
  - words
  - wpa_supplicant
  - xdg-desktop-portal
  - xdg-desktop-portal-gnome
  - xdg-desktop-portal-gtk
  - xdg-user-dirs-gtk
  - xorg-x11-drv-amdgpu
  - xorg-x11-drv-ati
  - xorg-x11-drv-evdev
  - xorg-x11-drv-fbdev
  - xorg-x11-drv-intel
  - xorg-x11-drv-libinput
  - xorg-x11-drv-nouveau
  - xorg-x11-drv-openchrome
  - xorg-x11-drv-qxl
  - xorg-x11-drv-vesa
  - xorg-x11-drv-vmware
  - xorg-x11-drv-wacom
  - xorg-x11-server-Xorg
  - xorg-x11-xauth
  - xorg-x11-xinit
  - yelp
  - zip
  - zram-generator-defaults

exclude-packages:
  - PackageKit
  - dnf
  - dnf-data
  - dnf-plugins-core
  - dnf5
  - dnf5-plugins
  - gstreamer1-plugin-openh264
  - mozilla-openh264
  - openh264

check-groups:
  filename: group
  type: file

check-passwd:
  filename: passwd
  type: file

etc-group-members:
  - wheel

ignore-removed-groups:
  - root

ignore-removed-users:
  - root

boot-location: modules
container-cmd:
  - /usr/bin/bash
default-target: graphical.target
documentation: true
rojig:
  description: null
  license: MIT
  name: fedora-silverblue
  summary: Fedora Silverblue base image
selinux: true
tmp-is-dir: true

postprocess:
  - |
    #!/usr/bin/env bash
    set -xeuo pipefail

    # Work around https://bugzilla.redhat.com/show_bug.cgi?id=1265295
    # From https://github.com/coreos/fedora-coreos-config/blob/testing-devel/overlay.d/05core/usr/lib/systemd/journald.conf.d/10-coreos-persistent.conf
    install -dm0755 /usr/lib/systemd/journald.conf.d/
    echo -e "[Journal]\nStorage=persistent" > /usr/lib/systemd/journald.conf.d/10-persistent.conf

    # See: https://src.fedoraproject.org/rpms/glibc/pull-request/4
    # Basically that program handles deleting old shared library directories
    # mid-transaction, which never applies to rpm-ostree. This is structured as a
    # loop/glob to avoid hardcoding (or trying to match) the architecture.
    for x in /usr/sbin/glibc_post_upgrade.*; do
        if test -f ${x}; then
            ln -srf /usr/bin/true ${x}
        fi
    done

    # Remove loader directory causing issues in Anaconda in unified core mode
    # Will be obsolete once we start using bootupd
    rm -rf /usr/lib/ostree-boot/loader

    # Undo RPM scripts enabling units; we want the presets to be canonical
    # https://github.com/projectatomic/rpm-ostree/issues/1803
    rm -rf /etc/systemd/system/*
    systemctl preset-all
    rm -rf /etc/systemd/user/*
    systemctl --user --global preset-all

    # Workaround for https://bugzilla.redhat.com/show_bug.cgi?id=2218006
    systemctl enable nfs-client.target

postprocess-script: postprocess.sh
